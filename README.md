# AjaxUpload
Upload files in an asynchronous way

This is an old project of mine, that I created back in 2007.<br/>
Imported into GitHub for archival puposes only.<br/>
There will be no updates.

## Screenshot
<img alt='Screenshot for AjaxUpload' src='http://pjondevelopment.50webs.com/images/articles/13.png' width='400' height='326' />

<h2>Introduction</h2><p>I was working on a project and I needed to upload a series of file to the web server (one at a time), without refreshing the whole page. While the <a href="http://www.asp.net/ajax/">ASP.NET AJAX</a> library is quite useful with the <code>UpdatePanel</code> that permits a wide range of page updates without refreshing the whole thing, it's currently incompatible with file uploading.</p><p>Searching through the web, I found a few techniques to upload a file to a web server: using a proprietary component, using the <a href="http://support.microsoft.com/kb/296772">ADODB.Stream</a>, and using a hidden&nbsp;IFrame.</p><p>The proprietary component was out of the question, not just because the probable price tag, but also because the requirement to install something in the user's box.</p><p>Using the ADODB.Stream, while a valid solution, it not only prevents using it in a cross-browser manner, as well, requires a change of configuration of the Internet Explorer on the user's box.</p><p>So, the technique used by this control is the hidden IFrame, which allow a cross browser functionality, while creating the desired result.</p><h2>Control's Behavior</h2><p>When the user selects a file to upload the control starts a post back directing the result to a hidden IFrame and when the file is received by the server the control raises at the server the <code>UploadedFile</code> event.</p><p>During the <code>UploadedFile</code> event the page housing the control can access the uploaded file by accessing the <codefile< />property of the event arguments. In <code>C#</code> add the handler in the constructor method. <code>VB</code> users can add the event handler in the <code>Sub New</code> or adding the <code>Handles...</code> directive at the appropriated method.</p><p>None of the page events or initialization methods and events (<code>OnInit</code>, <code>Init</code>, <code>OnInitComplete</code>, <code>InitComplete</code>, <code>OnLoad</code>, <code>Load</code>, <code>OnLoadComplete</code> and <code>LoadComplete</code>) are called when an uploaded file is received by the server. The reasons for this behavior are unknown, but welcome, at this point.</p><p>Each file receives a GUID that is passed in the event arguments of the UploadedFile event, and refereed to in the RemovedFile event, and in the FileList property.</p><p>If the user removes a file from the list of uploaded files, the event <code>RemovedFile</code> is raised.</p><p><strong>Update</strong>: I have changed the sample page in order to save the uploaded file under the project's root, in order to use the VirtualPath property.</p><p><strong>Known Issues</strong>:</p><ul><li>Currently the <strong>AjaxUpload</strong> control is incompatible with the <a href="http://go.microsoft.com/?linkid=7755937">.NET Framework 3.5</a> <a href="http://asp.net/AJAX/Documentation/Live/tutorials/UpdatePanelTutorials.aspx">UpdatePanel</a>. It will throw an exception in the <code>Sys$WebForms$PageRequestManager$_endPostBack</code> function. <br /><br />To work around this issue, add a <code>PostBackTrigger</code> to the <code>UpdatePanel</code> specifying the <strong>AjaxUpload</strong> control as its source.</li></ul><h2>AjaxUpload's Members</h2><h3>Public Properties</h3><table id="table3" class="Members" border="1" rules="rows" cellSpacing="0" cellPadding="2"><tbody><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>ConfirmRemoveMessage</code><br />Gets or sets the message shown when the user attempts to remove a file<pre class="vb" xml:space="preserve">Public Property ConfirmRemoveMessage() As String</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>DisplayIcon</code><br />Gets or sets a value indicating whether the file icon will be shown.<pre class="vb" xml:space="preserve">Public Property DisplayIcon() As Boolean</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>ErrorMessage</code><br />Gets or sets the message to be displayed when the file failed to be uploaded.<br /><pre class="vb" xml:space="preserve">Public Property ErrorMessage() As String</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>FileList</code><br /><b>Read Only</b>.<br />Gets an array of <code>AjaxUpload.FileInfo</code> that represents the files information&nbsp;uploaded by the client.<br /><strong>Note</strong>: This property is only available during post backs. All other times this property is empty, unless the <code>StoreFileListInSession</code> is set to <em>true</em>.<br /><pre class="vb" xml:space="preserve">Public ReadOnly Property FileList() As AjaxUpload.FileInfo()</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>NoControlMessage</code><br />Gets or sets the message to be displayed when the control does not have an input type=file available.<br /><pre class="vb" xml:space="preserve">Public Property NoControlMessage() As String</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>RemoveMessage</code><br />Gets or sets the message when the user hover over the remove icon.<br /><pre class="vb" xml:space="preserve">Public Property RemoveMessage() As String</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>StoreFileListInSession</code><br />Gets or sets a value indicating if the file list will be sotred in the Session object rather than in hidden fields.<br /><pre class="vb" xml:space="preserve">Public Property StoreFileListInSession() As Boolean</pre></td></tr></tbody></table><h3>Public Methods</h3><p><table id="table2" class="Members" border="1" rules="rows" cellSpacing="0" cellPadding="2"><tbody><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Method" src="http://pjondevelopment.50webs.com/images/class/method.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>Clear</code><br />Removes all the files from the list.<br /><strong>Note:</strong> for each file the <code>AjaxUpload</code> control will raise the <code>RemovedFile</code> event, which in turn may set the <code>PreventRemove</code> property that the <code>Clear</code> method will respect.<br />So, even calling <code>Clear</code> does not guarantee that the <code>FileList</code> property will be empty.<pre class="vb" xml:space="preserve">Public Sub Clear()</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Method" src="http://pjondevelopment.50webs.com/images/class/method.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>Contains</code><br />Returns true if in the <code>AjaxUpload</code> file list contains the specified file name.<pre class="vb" xml:space="preserve">Public Function Contains( _<br />          ByVal fileName as String) as Boolean</pre></code /></td></tr></tbody></table></p><h3>Public Events</h3><p><table id="Table5" class="Members" border="1" rules="rows" cellSpacing="0" cellPadding="2"><tbody><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Event" src="http://pjondevelopment.50webs.com/images/class/event.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>UploadedFile</code><br />Occurs when a file is uploaded to the server.<pre class="vb" xml:space="preserve">Public Event UploadedFile( _&#13;                ByVal sender As Object, _&#13;                ByVal e As UploadedFileEventArgs)</pre>If the page housing the control updates the <code>VirtualPath</code> property of the <code>UploadedFileEventArgs</code> the AjaxUpload control will show a link to the uploaded file, instead of only showing the name.<br />If, for some reason, the file is rejected by the housing page, callers should set the <code>UploadError</code> property of the event arguments and, optionally, the <code>ErrorMessage</code> informing the user the motive.</td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Event" src="http://pjondevelopment.50webs.com/images/class/event.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>RemovedFile</code><br />Occurs when a file is&nbsp;being removed at the client.<pre class="vb" xml:space="preserve">Public Event RemovedFile( _&#13;                ByVal sender As Object, _&#13;                ByVal e As RemovedFileEventArgs)</pre>If, for some reason, the file should not be removed from the list, callers should set the <code>PreventRemove</code> property of the event arguments and, optionally, the <code>PreventRemoveReason</code> informing the user the reason.</td></tr></tbody></table></p><h2>AjaxUpload.FileInfo Class</h2><h3>Public Properties</h3><p><table id="table3" class="Members" border="1" rules="rows" cellSpacing="0" cellPadding="2"><tbody><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>ContentType</code><br />Gets the content-type of an uploaded file.<pre class="vb" xml:space="preserve">Public Property ContentType() As String</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>FileName</code><br />Gets the name of an uploaded file.<pre class="vb" xml:space="preserve">Public Property FileName() As String</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>FileSize</code><br />Gets the size, in bytes, of an uploaded file.<pre class="vb" xml:space="preserve">Public Property FileSize() As Integer</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>ID</code><br />Gets the GUID that represents the ID given by the <code>AjaxUpload</code> control to the uploaded file.<pre class="vb" xml:space="preserve">Public Property ID() As System.Guid</pre></td></tr><tr><td class="Icon" vAlign="top" align="center"><img alt="Public Property" src="http://pjondevelopment.50webs.com/images/class/property.gif" width="16" height="16" /></td><td class="Definition" vAlign="top"><code>Url</code><br />Gets the <code>System.Uri</code> object that was set, by the page housing the control, during the <code>UploadedFile</code> event.<pre class="vb" xml:space="preserve">Public Property Url() As System.Uri</pre></td></tr></tbody></table></p>
